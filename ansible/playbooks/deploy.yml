---
- name: Deploy FreeRADIUS
  hosts: all
  become: true

  pre_tasks:
    - name: Wait for cloud-init to finish
      ansible.builtin.shell: |
        for i in $(seq 1 60); do
          if [ -f /var/lib/cloud/instance/boot-finished ]; then
            echo "cloud-init finished"
            exit 0
          fi
          sleep 5
        done
        echo "Timed out waiting for cloud-init"
        exit 1
      changed_when: false

  roles:
    - freeradius
    - role: vector
      when: vector_enabled | default(false) | bool
